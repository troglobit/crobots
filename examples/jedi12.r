/*
ZZZZZZZZZZZZZZZZZZZZZZZZZZZOZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZOZZZZZZZOOZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZOOOOOOOOOZOOZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$ZZZZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZOOOOOOOOOOOZOZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$$$ZZZZZZZZZZZZZZ
ZZZZZZZZZOZZZZZZZOOOOOOOOOOOOOOOOZZZZZZZZZZZZZZZZZZZZZZ$$$777I77$$$ZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZOOOOOOOOOOZZOZZZZZZZZZZZZZZZZZZZZ$$77I?=?I7$$ZZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZOZOOOOOOOOOOZZZZZZZZZZZZZZZZZZZZZZZZ$$$7I?..+I7$$$ZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZOOOOOOOOOOOOOOZZZZZZZZZZZZZZZZZZZZZ$$77I= .?I7$$$ZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZOOOOOZZZZZZZZZZZZZZZZZZZZZZZZZ$$$7I?,.~?I7$$$ZZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZOZZZZZZZZZZZZZZZZZZZZZZZZZZ$$77I+..+I77$$$$ZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZOZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$7I?~.,?I77$$$$ZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$77I+..=?I7$$$$$ZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$7I?=..+I77$$$$$$ZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$77I?,.~?I77$$$$$$$$ZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$7I?=..+I77$$$$$$ZZZZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$77I?:.,?I77$$$$$$$Z$ZZZ$ZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$77I+..=?I77$$$$$$Z$$ZZZZZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$77I?~..+II77$$$$$$$$$$$$$ZZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$77I+..:?I777$$$$$$$$$$$$$$$ZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$77I?=..=?I77$$$$$$$$$$$$$$$ZZZ
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$777I?,.,+I777$$$$$$$$$$$$$$$$$Z
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$$$77II+..=?I777$$$$$$$$$$$$$$Z$Z$
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$$$$$$77I?~..+II77$$$$$$$$$$$$$$$$$Z$
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$$$$$$$$7II+..:?I77$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$Z$$$$$$$$$$77I?=..=?I77$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ$$$$$$$$$$$$$$$$$777I+:..+II77$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZZZZZZZZZ$Z$$$$$$$$$$$$$$$$$$$$$77I?+..~?I77$$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZZZZZZ$$$$$$$$$$$$$$$$$$$$$$$$$777I?~..=?I77$$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZZZZ$$$$$$$$$$$$$$$$$$$$$$$$$$$77II+,.:+II77$$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZZ$$$$$$$$$$$$$$8MMMMM$$$$$$$$$77I?=..=?I777$$$$$$$$$$$$$$$$$$$$$
ZZZZZZZZZZZZZZZZ$$$$$$$$$$$$DNNNMNMNDDNN$$$$$77II+:..+?I777$$$$$$$$$$$$$$$$$$$$$
ZZZZZ$ZZZZ$ZZZZZ$$$$$$$$$$$MMNNZM$ONZOMMNO$$$77I?=..:?II777$$$$$$$$$$$$$$$$$$$$$
ZZZZZZZ$ZZZZZ$$$$$$$$$$$$$MMO$NND8O$+D8NZDZ777II+:..=?II777$$$$$$$$$$$$$$$$$$$$$
ZZZ$$ZZZ$$$$$$$$$$$$$$$$$NMZII?+=+===+OO7Z8777I?+..,+II777$$$$$$$$$$$$$$7$$$$$$$
$$$ZZ$Z$$$$$$$$$$$$$$$$$$D87???++~~==+IZM8D$77I?~..~+II777$$$$$$$$$$$$$$77$$$$$$
$$$$$$$$$$$$$$$$$$$$$$$$ZN$7I??+=~~~=+=ZDNDD7I?+,..=?I777$7$$$$$$$$$$$$7777777$$
$Z$$$$$$$$$$$$$$$$$$$$$$$II7II++=+==++?OMD88II?=..:+?I777$$$$$$$$$$$$$777777777$
$$$$$$$$$$$$$$$$$$$$$$$$$$ND7ZZIII?=++?8DDOOII+: .=?II777$7$$$$$$$$$$77777777777
$$$$$$$$$$$$$$$$$$$$$$$$$$ZNN+?ODMD??++$Z?I8I?=. .+?II777$$$$$$$$$77$77777777777
$$$$$$$$$$$$$$$$$$$$$$$$77ZZ$~==7?===++$O+?7I+~ .~+II777777$$$77$$$7777777777777
$$$$$$$$$$$$$$$$$$$$$$$$$7O$+=+==+==++??~=OI?=, .=?II777$7$77$777$77777777777777
$$$$$$$$$$$$$$$$$$$$$$$$$$NO$N$++==?+I$==ZII+~. ,+?II7777777$$77$$77777777777777
$$$$$$$$$$$$$$$$$$$$$$$$7Z7IZ77+=+=?77$OO7I?+:..~?II77777$7$$$777777777777777777
$$$$$$$$$$$$$$$$$$$7$7$778DO88$7?+??77$IIII?=. .+?II7777777777777777777777777777
$$$$$$$$$$$$$$$$$77777777O$77I+7Z7$Z$Z?OII?+~..:+?II7777777777777777777777777777
$$$$$$$$$$$$$$$$$77777777Z$Z777ZO8ZOO?OZ=I?=,..=?II77777777777777777777777777777
$$$$$$$$$$$$$$$77777$7$77Z8OO$ZDNDD$8OZ=~~+:..,+?II777777$$777777777777777777777
$$$$$$$$$$$$$7777777$O8DMM8MDDD8$ND8OZ?=~:~,..:==~=?77777$$777777777777777777777
$$$$$$$$$$$$$$7$===++7$OMNN8NMMDDD8OOD=~~=:. .~~~=~~~==77$$77$777777777777777777
$$$$$$$$$$$$++===~=~~=Z?O8DD8ZNDOOOZ8==~~~,..:~~~~~~~~~==77777777777777777777777
$$$$$$$$$$$8I++=~~~~~~~=+Z?7$++8OOOZ+=~~~:...:+~~=~~~~~==+I$$7777777777777777777
$$$$$$$$$$8MZI+==~~~~::?:?=+7++7OOZ8=~~~=,...=~~~+~~~~==+~~$$$777777$77777777777
$$$$$$$$7$D7ON??=+=~:~~I:=?~+I+=8OZ+=~~:~...,+~:===~~=+=~~?$$$7$7$$$777777777777
$$$$$$77$$=II=I+=~==::~7~~+==?=~+ZD=~~:+:...:~~:I~~===~~~::$$$$$$$7777777$7777$7
$$$$$$$$$$=$?=~:+=~?=:~+=~?+?+~~+7==~~~=,..,~~:7=~==+~:+~?:$$$$$$777777$777$$$77
$$$$$$$$$$8I~7=~=8+=D=::=~==+~:~===~=~:~...,~~=~~==+~==::=I$$$$$777777$7777$$777
$$$$$$$$$OOZ$+~I=~I+~7~:~~~+=?~~~===~~~:...:::+==+~==~~:::7$$$$$$7777$$777777777
$$$$$$$$$$=DZI=~~~=~?=~:=:~==Z~~$=~~~:~,..,:~~=+=~~~=:=~:~7$$$$$7777777777777777
$$$$$$$$$$O7I=~=~~~~~:=:Z~~I++I=7=~~~=:...:::~?=~~=~~+:::~7$$$$$777777$777777777
$$$$$$$$7788$7?++:~::~:~I~:+I=?Z=~~~~~,..,::~=7~=I~~~::::~$$$$$$$$7777777777$777
$$$$$$$$$78OZ$7II+=~:~~=?~~+I=$==~~:::. .,::++~+~~=~:~:~:~7$$$$$$$$7$77$$7$$$7$7
$$$$$$$$77$87I?I?I++=~~~7+~+7=I==~~:=,...:::Z+I~~~::::::::$$$$$$$$$$7$7$$$$$7$$7
$$$$$$$$$7==?=?+=+=++~~~~?~+I?====~=:, .,::~Z$=~~~:~~:~:~~7$$$$$$$$$$777$7$$7$$7
$$$$$$$$$$~=?Z$===~~~=+~~~==7++===~=:. .,::?$~+~=:~=~::~:~7$$$$$$$$$$77$$$$7$$$$
$$$$$$$$$OZ~=$OO=?+==~====~~~+===~?7=..:?:+$=?==~===~::~:~$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$Z$$+IOOO=??++++++=++=~~~I~+=~+?++Z+~~===I~:::~::~$$$$$$$$$$$$$$$$$$$$$7
$$$$$$$$$OZIII+OO8O7+?I$NNDDNDDI+++Z7??I+Z?~==~?+~~::::::~$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$Z7+?II7=887$8ZMNNMDNNMNNOD88IOIO=~~~=++==::~:::~~$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$O$?I7?$Z?DO8NMMNMNNN8Z?~=D888+~=~~=~=+==~:~:::~~=$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$ZZII7I7ZOO8MNMMNMMND8OI==:8?O?~~=+=+==::::::::~~=$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$OOO?77I$O88=MMMMNMM87=?OI=~:7N====++~~::~::~:::~=$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$$$ODZ$7ZOOOO?MMMMMM8Z==+D7+~====+:~::::~~::::::~+$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$8?78D8ZZO8OOOO?MMMM8=I$Z7I$==~=~~~:::~~~::::::~~?$$$$$$$$$$$$$$$$$$$$$$
ZZZ$$$$$$OZIZDDDZZ8DO88O88NOOZ7$++O7??=:::::::~~::::::::~I$$$$$$$$$$$$$$$$$$$$$$
ZZZ$$Z$$$$OOI$8NNDDDOOO8DNNMN8$+8Z?=+I==+~::::::::~::::~~7$$$$$$$$$$$$$$$$$$$$$$
$$??Z??+?7+?O?OIOZNOI=O$$ZO88DMN$+?======?~::::::::::::~~$$$$$$$$$$$$$$$$$$$$$$$
OZZZZZZ$$$$$$$MNMDOMDDMDD8OOO8D8O+==++?~~=M=~::::::::::~~$$$$$$$$$$$$$$$$77$$$7$
 
 ======  ======  ====      ==
   ==    ==      ==  ==    ==
   ==    ==      ==    ==  ==
   ==    ====    ==    ==  ==
   ==    ==      ==    ==  ==
  ==     ==      ==    ==  ==
===      ======  ========  ==
 
Crobot      : Jedi
Type        : Macro
Version     : 12.2
Author      : Maurizio Camangi
Begin       : 13-02-2012
Revision    : 01-01-2013

Jedi12 integra il movimento di flash8c nel 3vs3, nel caso in cui non vi sia
alcun avversario nell'angolo opposto (senso orario): compie un giro completo,
e poi riprende con l'algoritmo consueto. Jedi12 perde l'uso delle variabili
bidimensionali (vettori): coreografiche e superflue.
*/

int
	ang,
	oang,
	range,
	orange,   /* Variabili di puntamento                              */
	d,dmax,   /* Variabili temporanee salva danni subiti              */
	dir,      /* Direzione del cammino                                */
	posx,     /* Variabili ad 1 bit                                   */
	posy,     /* salva posizione                                      */
	dist,     /* Distanza dal corner                                  */
	flag,     /* Bit-oriented flag per la gestione del movimento      */
	timer,    /* Timer per il conteggio dei nemici                    */
	enemies,  /* Conta nemici superstiti                              */
  t,b,      /* Timer oscillazione                                   */
  i,td,tl,  /* Variabili di utilitÃ                                  */
  deg1,     /* Limite inferiore di scansione per contare i nemici   */
  deg2;     /* Limite superiore di scansione per contare i nemici   */

stop()
{
  fire2(drive(dir,t=0));  
  while(speed()>59) ;
}

fastradar() /* Conta nemici fast */
{
  enemies=3
  -(scan(deg1,    10)!=0)
  -(scan(deg1+20, 10)!=0)
  -(scan(deg1+40, 10)!=0)
  -(scan(deg1+60, 10)!=0)
  -(scan(deg1+80, 10)!=0)
  -(scan(deg1+100,10)!=0)
  ;
}

runX()
{
  dir=180*!posx;
  if(posx) { while(loc_x()<910) fire3(dir,100); while(loc_x()<950) drive(dir,100); }
  else     { while(loc_x()> 90) fire3(dir,100); while(loc_x()> 50) drive(dir,100); }
  stop();
}

runY()
{
  dir=270-180*posy;
  if(posy) { while(loc_y()<910) fire3(dir,100); while(loc_y()<950) drive(dir,100); }
  else     { while(loc_y()> 90) fire3(dir,100); while(loc_y()> 50) drive(dir,100); }  
  stop();
}

corner()
{
  if (speed()) stop(); if (flag^posx^posy) runY(runX()); else runX(runY());
}

fire(dir) /* Many thanks to Daniele Nuzzo */
{
  int asin,acos;
  /*if (safe) return;*/
  if (speed()<100) drive(dir,100); 
      
  if (scan(ang,10)>150)
  {  
      asin=(sin(ang-dir)/14384);
      acos=(cos(ang-dir)/3796)-230;

      ang-=18*(scan(ang-18,10)>0);  
      ang+=18*(scan(ang+18,10)>0); 

      if(scan(ang-16,10)) ang-=8;
      else if(scan(ang+16,10)) ang+=8;
      if(scan(ang-12,10)) ang-=4;
      else if(scan(ang+12,10)) ang+=4;
      if(scan(ang-11,10)) ang-=2;
      if(scan(ang+11,10)) ang+=2;

      if (orange=scan(oang=ang,3))
        {
            if(scan(ang-13,10)) ang-=5;
            else if(scan(ang+13,10)) ang+=5; 
            if(scan(ang+12,10)) ang+=4;
            else if(scan(ang-12,10)) ang-=4;
            if(scan(ang-11,10)) ang-=2;
            if(scan(ang+11,10)) ang+=2;

            cannon(ang+(ang-oang)*((880+(range=scan(ang,10)))/482)-asin,
                   range*230/(orange-range-acos)); 
        }  else search(); 
  } else search();  
}

search()
{
  if (scan(ang-=350,10)) return fire2();
  if (scan(ang-=20,10))  return fire2();
  if (scan(ang-=320,10)) return fire2();
  if (scan(ang-=60,10))  return fire2();
  if (scan(ang-=280,10)) return fire2();
  if (scan(ang-=100,10)) return fire2();
  if (scan(ang-=240,10)) return fire2();
  if (scan(ang-=140,10)) return fire2();
  if (scan(ang-=200,10)) return fire2();
  if (scan(ang-=180,10)) return fire2();
  if (scan(ang-=160,10)) return fire2();
  if (scan(ang-=220,10)) return fire2();
  if (scan(ang-=120,10)) return fire2();
  if (scan(ang-=260,10)) return fire2();
  if (scan(ang-=80,10))  return fire2();
  if (scan(ang-=300,10)) return fire2();
  if (scan(ang-=40,10))  return fire2();
  if (scan(ang-=340,10)) return fire2();
}

fire2()
{
  if (range=scan(oang=ang,10)) {
    /*if (range>500) return cannon(ang,range);*/
    if (scan(ang+350,10)) ang+=355; else ang+=5;
    if (scan(ang+350,10)) ang+=357; else ang+=3; 
    cannon((ang<<1)-oang,(scan(ang,10)<<1)-range);
  } else search();   
}

fire3(dir,v)
{
  drive(dir,v);
	if (range=scan(oang=ang,10)) 
	{
		if (scan(ang-8,5))  
		{ 	
			if (scan(ang-=5,2)) ; 
			else ang-=4; 
		}
		else
		{
			if (scan(ang+8,5))  
			{
				if (scan(ang+=5,2)) ; 
				else ang+=4; 
			}
      else
      {
				if (scan(ang,1)) ;
				else if (scan(ang-=3,2)) ; else ang+=6;
			}
		}
		return(cannon((ang<<1)-oang,(scan(ang,10)<<1)-range)); 
	} 
	else 
	{
		if(range=scan(ang+=20,10)) cannon(ang,range);
		else if(range=scan(ang-=40,10)) cannon(ang,range);
		else ang+=80;
	}
}

int look(a)
{
       if (scan(a,10))    ;
  else if (scan(a+=20,10));
  else return 0;
  ang=a;
  return 1;
}

main() /* Inizializza alcune variabili ed innesca la routine principale */
int abra,bula,cadabra;
{
  corner(posx=loc_x(posy=(loc_y(tl=td=32)>499))>499);
  fastradar(deg2=(deg1=(90*((posy<<1)+(posx^posy))))+100);
  while (enemies<1) /* fase 1 */
  {
    dir=deg1+(30<<flag);
    if (look(deg1+(70*flag)))
    {
      fire(dir);
      while(scan(ang,10)>840) fire2();
      corner();
    }
    else if (scan(dir,10))
    {
      fire(ang=dir);
      while(scan(ang,10)>660) fire(dir);
      corner();
    }
    else
    {
      while(++t<4) fire(dir);
      corner(tl=timer);
    }
    if ((d=damage()-d)>dmax)
    {
      dmax=d; flag^=1;
    }
    if ((++timer>tl)&&(range>400))
  	{
  	    if ((timer>115)&&(damage()<60)) enemies=1;
  	    else fastradar(tl=timer+(td>>=1)+1);
    }
  }
  while(enemies<=1) /* fase 2 */
  {
    if (look(deg1))
    {
      dir=deg1+(30<<flag);
      if (look(deg1+(70*flag)))
      {
        fire(dir);
        while(scan(ang,10)>680) fire(dir);
        corner();
        flag^=1;
      }
      else if (scan(dir,10))
      {
        fire(ang=dir);
        while(scan(ang,10)>640) fire(dir);
        corner();
        flag^=1;
      }
      else
      {
        while(++t<4) fire(dir);
        corner();
        if ((d=damage()-d)>dmax)
        {
          dmax=d; flag^=1;
        }
      }
      if ((++timer%2)&&(range>400))
    	{
  	    if ((timer>125)&&(damage()<40)) enemies=2;
  	    else {
	        int deg, brange; deg=deg1-20; brange=1500; enemies=3;
	        while((deg<=deg2)&& enemies)
    		    if (range=scan(deg+=20, 10))
    		    {
    		      --enemies;
    		      if (range<brange)
    		      {
          			ang=deg;
          			brange=range;
    		      }
    		    }
    		} 
      }
    }
    else
    {
      dir=deg1; abra=(posy<<1)|(posx^posy); t=0;
      while(t<4)
      {
        if (abra&1) bula=loc_y();     else bula=loc_x();
        if (abra&2) cadabra=bula>180; else cadabra=bula<820;
        
        if (cadabra) fire(dir);
        else
        {
          fire3(dir+=90,0); if (scan(dir,10)) ang=dir; ++abra; timer+=++t;
        }
      }
      fastradar(t=0);
    }    
  }
	while(1)
  {
		if (((posx=loc_x())%880)<120) dir=180*(posx>500);
		else if (((posy=loc_y())%880)<120) dir=90+180*(posy>500);
		else if (range>600) dir=ang+25;
		else if (range<150) dir=ang+195;
		else dir=ang+180*(b^=1);
	
		fire3(dir,100);
		fire3(dir,100);
		fire3(dir,100);         
  }
}

